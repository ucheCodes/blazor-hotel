@page "/rooms"
@inject IRoomControl rc
@inject IStore store
@inject IRoomControl rc
@inject NavigationManager navigationManager

<section>
    <Banner slides="slides" sliderAnimation="@sliderAnimation" />
</section>
<section id="rooms-view" class="blog-wrapper pb-0">
    @if (rooms.Count == 0 || bookedRooms.Count >= rooms.Count)
    {
        <div class="row">
            <h3>Demo Rooms</h3>
            <span class="msg red">N.B : All registered rooms on this platform has been booked. Kindly contact the Management.</span>
            <div class="col-md-6 mb-4">
                <div class="card p-0 border-0 rounded-0">
                    <div class="blog-img">
                        <img src="./images/room//mky-moody-AUF6Gl4wwzA-unsplash.jpg" alt="blog">
                    </div>
                    <div class="blog-content bg-white p-4">
                        <h5 class="text-decoration-underline mb-4">Opulence Suits</h5>
                        <span class="price">price: &#8358;300 / night</span>
                        <p class="mt-2">
                            Discover a realm of refined indulgence where every moment is designed to
                            evoke a sense of awe and wonder. Immerse yourself in a world of elegance,
                            opulence, and glamour that will leave an everlasting impression, ensuring
                            your stay is nothing short of extraordinary.
                        </p>
                        <div class="flex">
                            <span><i class="fas fa-wifi"></i> Free Wi-fi</span>
                            <span><i class="fas fa-bed"></i> Standard Bed</span>
                            <span><i class="fas fa-music"></i> Music concert</span>
                            <span><i class="fas fa-dumbbell"></i> Gym</span>
                            <span><i class="fas fa-hamburger"></i>Food</span>
                            <span><i class="fas fa-volleyball-ball"></i> Sports</span>
                        </div>
                        <a class="main-btn mt-2">Book Now</a>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card p-0 border-0 rounded-0">
                    <div class="blog-img">
                        <img src="./images//room//sasha-kaunas-67-sOi7mVIk-unsplash.jpg" alt="blog">
                    </div>
                    <div class="blog-content bg-white p-4">
                        <h5 class="text-decoration-underline mb-4">Opulence Suits</h5>
                        <span class="price">price: &#8358;300 / night</span>
                        <p class="mt-2">
                            Discover a realm of refined indulgence where every moment is designed to
                            evoke a sense of awe and wonder. Immerse yourself in a world of elegance,
                            opulence, and glamour that will leave an everlasting impression, ensuring
                            your stay is nothing short of extraordinary.
                        </p>
                        <div class="flex">
                            <span><i class="fas fa-wifi"></i> Free Wi-fi</span>
                            <span><i class="fas fa-bed"></i> Standard Bed</span>
                            <span><i class="fas fa-music"></i> Music concert</span>
                            <span><i class="fas fa-dumbbell"></i> Gym</span>
                            <span><i class="fas fa-popcorn"></i>Food</span>
                            <span><i class="fas fa-volleyball-ball"></i> Sports</span>
                        </div>
                        <a class="main-btn mt-2">Book Now</a>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card p-0 border-0 rounded-0">
                    <div class="blog-img">
                        <img src="./images/room/venice-hotel-tqwvsyL2Kd0-unsplash.jpg" alt="blog">
                    </div>
                    <div class="blog-content bg-white p-4">
                        <h5 class="text-decoration-underline mb-4">Opulence Suits</h5>
                        <span class="price">price: &#8358;300 / night</span>
                        <p class="mt-2">
                            Discover a realm of refined indulgence where every moment is designed to
                            evoke a sense of awe and wonder. Immerse yourself in a world of elegance,
                            opulence, and glamour that will leave an everlasting impression, ensuring
                            your stay is nothing short of extraordinary.
                        </p>
                        <div class="flex">
                            <span><i class="fas fa-wifi"></i> Free Wi-fi</span>
                            <span><i class="fas fa-bed"></i> Standard Bed</span>
                            <span><i class="fas fa-music"></i> Music concert</span>
                            <span><i class="fas fa-dumbbell"></i> Gym</span>
                            <span><i class="fas fa-french-fries"></i>Food</span>
                            <span><i class="fas fa-volleyball-ball"></i> Sports</span>
                        </div>
                        <a class="main-btn mt-2">Book Now</a>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card p-0 border-0 rounded-0">
                    <div class="blog-img">
                        <img src="./images/room/point3d-commercial-imaging-ltd-GUno-FetWJM-unsplash.jpg" alt="blog">
                    </div>
                    <div class="blog-content bg-white p-4">
                        <h5 class="text-decoration-underline mb-4">Opulence Suits</h5>
                        <span class="price">price: &#8358;300 / night</span>
                        <p class="mt-2">
                            Discover a realm of refined indulgence where every moment is designed to
                            evoke a sense of awe and wonder. Immerse yourself in a world of elegance,
                            opulence, and glamour that will leave an everlasting impression, ensuring
                            your stay is nothing short of extraordinary.
                        </p>
                        <div class="flex">
                            <span><i class="fas fa-wifi"></i> Free Wi-fi</span>
                            <span><i class="fas fa-bed"></i> Standard Bed</span>
                            <span><i class="fas fa-music"></i> Music concert</span>
                            <span><i class="fas fa-dumbbell"></i> Gym</span>
                            <span><i class="fas fa-burger-soda"></i>Food</span>
                            <span><i class="fas fa-volleyball-ball"></i> Sports</span>
                        </div>
                        <a class="main-btn mt-2">Book Now</a>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
      <div class="row">
          @foreach (var room in rooms)
          {
                if (!bookedRooms.Contains(room.Id))
                {
                    <div class="col-md-6 mb-4">
                        <div class="card p-0 border-0 rounded-0">
                            <div class="blog-img">
                                <img src="@room.ImagePath" alt="blog">
                            </div>
                            <div class="blog-content bg-white p-4">
                                <h5 class="text-decoration-underline mb-4">@room.Name</h5>
                                <span class="price">price: &#8358;@room.Price / night</span>
                                @if (store.State().IsAdmin.isAdmin)
                                {
                                    <div class="admin">
                                        <i @onclick="(() => {deleteId = room.Id; deleteName = room.Name; showDialog = true;})" class="fas fa-trash"></i>
                                        <i @onclick="(() =>{Edit(room);})" class="fas fa-edit"></i>
                                    </div>
                                }
                                <p class="mt-2">
                                @room.Description
                            </p>
                            <div class="flex">
                                <span><i class="fas fa-wifi"></i> Free Wi-fi</span>
                                <span><i class="fas fa-bed"></i> Standard Bed</span>
                                <span><i class="fas fa-music"></i> Music concert</span>
                                <span><i class="fas fa-dumbbell"></i> Gym</span>
                                <span><i class="fas fa-hamburger"></i>Food</span>
                                <span><i class="fas fa-volleyball-ball"></i> Sports</span>
                            </div>
                            <a @onclick="(() => BookRoom(room.Id))" class="main-btn mt-2">Book Now</a>
                        </div>
                    </div>
                    </div>
                }
            }
      </div>  
    }
    @if (showDialog)
    {
        <section class="dialog">
            <div class="container">
                <span @onclick="CloseDialog" class="close">x</span>
                <span>Do you want to delete @deleteName permanently?</span>
                <button @onclick="(() => Delete(deleteId))" class="main-btn">Confirm Delete</button>
            </div>
        </section>
    }
</section>

@code {
    public string sliderAnimation { get; set; } = "fade-in";
    public List<Room> rooms { get; set; } = new List<Room>();
    private List<string> bookedRooms = new();
    private bool showDialog = false;
    private string deleteId = "";
    private string deleteName = "";
    [Inject]
    private IWebHostEnvironment? _environment { get; set; }
    protected async override Task OnInitializedAsync()
    {
        var data = await rc.ReadAll();
        bookedRooms = rc.GetBookedRooms().Result;
        rooms = data.OrderByDescending(r => r.Date).ToList<Room>();
    }
    private List<Slide> slides = new List<Slide>
    {
        new Slide {
            IsActive = true,
            Header = "Welcome to Your Real Dream Hotel",
            ImagePath = "./images/room/r1.jpg"
        },
        new Slide {
            IsActive = false,
            Header = "Indulge in opulence as you experience our meticulously designed accommodations",
            ImagePath = "./images/room/venice-hotel-tqwvsyL2Kd0-unsplash.jpg" },
            new Slide {
            IsActive = false,
            Header = "Relax and feel the comfort of our cozy accommodations",
            ImagePath = "./images/room/mky-moody-AUF6Gl4wwzA-unsplash.jpg" },
            new Slide {
            IsActive = false,
            Header = "Unwind and Experience Adventure with Our Culture Rich Facilities",
            ImagePath = "./images//room//sasha-kaunas-67-sOi7mVIk-unsplash.jpg"  },
            new Slide {
            IsActive = false,
            Header = "Step into a world of luxury & unparalleled hospitality",
            ImagePath = "./images/room/point3d-commercial-imaging-ltd-GUno-FetWJM-unsplash.jpg" },
    };
    private void BookRoom(string id)
    {
        if (!string.IsNullOrEmpty(id))
        {
            navigationManager.NavigateTo($"/book/{id}");
        }
    }
    private void Edit(Room room)
    {
        store.SetEditingValue(2, JsonConvert.SerializeObject(room));
        navigationManager.NavigateTo("/admin");
    }
    public void Dispose()
    {
        store.RemoveStateChangedAction(() => { StateHasChanged(); });
    }
    public void DeleteImage(string filePath)
    {
        if (_environment != null)
        {
            string imagePath = Path.Combine(_environment.WebRootPath, filePath);

            if (File.Exists(imagePath))
            {
                File.Delete(imagePath);
            }
        }
    }
    private void CloseDialog()
    {
        showDialog = false;
        deleteId = string.Empty;
        deleteName = string.Empty;
    }
    private void Delete(string id)
    {
        if (!string.IsNullOrEmpty(id))
        {
            var isDel = rc.Delete(id);
            if (isDel.Result)
            {
                var r = rooms.Find(x => x.Id == id);
                DeleteImage(r?.ImagePath ?? "");
                rooms.Remove(r ?? new());
                CloseDialog();
            }
        }
    }
}